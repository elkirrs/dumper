import{_ as u}from"./RestoreDatabase-BvNc5gqq.js";import{_ as c}from"./YamlViewer-CyaCBeEQ.js";import{_ as m}from"./List-CzjS5ryG.js";import{_ as v}from"./Chip-CJsUel5s.js";import{_ as y,c as b,a as e,t as n,b as a,w as s,F as k,o as _,d as o}from"./index-CuCy4DLw.js";import{V as l}from"./VAlert-DNgrSmkw.js";import"./VSlideGroup-CpROUN5z.js";const x={components:{RestoreDatabase:u},data(){return{driver:"influxdb",database:"Influx Data",utility:["influx"],snackbar:!1,configKeys:[{key:"title",value:"Human-readable database name",type:"string",required:!1,info:{text:"",link:""}},{key:"name",value:"Database name",type:"string",required:!0,info:{text:"",link:""}},{key:"server",value:"The link to the server from the servers section list",type:"string",required:!0,info:{text:"",link:""}},{key:"driver",value:"Driver database",type:"string",required:!0,info:{text:"For version 2.x",link:""}},{key:"format",value:"Database dump format",type:"string",required:!0,info:{text:'Format list: "tar"',link:""}},{key:"token",value:"Token auth to database",type:"string",required:!0,info:{text:"For version 2.x",link:""}},{key:"port",value:"Database connection port",type:"integer",required:!0,info:{text:"For version 2.x",link:""}},{key:"remove_dump",value:"Remove dump file after created (default true)",type:"boolean",required:!1,info:{text:"",link:""}},{key:"storages",value:"Storage list when the dump need to upload",type:"array",required:!0,info:{text:"(Not required if storage set up in global setting)",link:""}},{key:"encrypt",value:"Encrypt database",type:"object",required:!1,info:{text:"",link:"#/crypt/database"}},{key:"shell",value:"Run shell scrypt",type:"object",required:!1,info:{text:"",link:"#/shell"}},{key:"docker",value:"Create dump in docker",type:"object",required:!1,info:{text:"",link:"#/docker"}},{key:"options",value:"Additional options for the database",type:"object",required:!1,info:{text:"",link:""},sub:[{key:"source",value:"Full path to dump util",type:"string",required:!1},{key:"version",value:"Version Influx DB",type:"string",required:!1,info:{text:"Support versions: 2.x, 3.x"}},{key:"org",value:"Organization name",type:"string",required:!1,info:{text:"For version 2.x",link:""}},{key:"org_id",value:"Organization ID",type:"string",required:!1,info:{text:"For version 2.x",link:""}},{key:"bucket",value:"Bucket name",type:"string",required:!1,info:{text:"For version 2.x",link:""}},{key:"bucket_id",value:"Bucket ID",type:"string",required:!1,info:{text:"For version 2.x",link:""}},{key:"skip-verify",value:"Skip the TLS certificate verification",type:"boolean",required:!1,info:{text:"For version 2.x",link:""}},{key:"start",value:"Start time range",type:"string",required:!1,info:{text:"For version 2.x",link:""}},{key:"end",value:"End time range",type:"string",required:!1,info:{text:"For version 2.x",link:""}},{key:"filter",value:"Filtered data",type:"string",required:!1,info:{text:"For version 2.x"}},{key:"data_dir",value:"Path to data Influx DB",type:"string",required:!0,info:{text:"For version 3.x"}},{key:"node_id",value:"Name node influx DB",type:"string",required:!0,info:{text:"For version 3.x"}}]},{key:"dir_remote",value:"Dir remote for dumps",type:"string",required:!1,info:{text:'default value from global settings (if the default value is not set, then "./" is used.)',link:""}}],yamlConfig:[],restoreDatabase:[{title:"Use this command to restore database for version 2.x",value:"$ influx restore /backups/2020-01-20_12-00/"},{title:"Use this command to restore database for version 3.x",value:"$ systemctl stop influxdb3  \\ \n && rm -rf ${DATA_DIR}/${NODE_ID}/* \\ \n && mkdir -p ${DATA_DIR}/${NODE_ID} \\ \n && cp ${BACKUP_DIR}/_catalog_checkpoint ${DATA_DIR}/${NODE_ID}/ \\ \n && cp -r ${BACKUP_DIR}/catalog ${DATA_DIR}/${NODE_ID}/ \\ \n && cp -r ${BACKUP_DIR}/wal ${DATA_DIR}/${NODE_ID}/ \\ \n && cp -r ${BACKUP_DIR}/dbs ${DATA_DIR}/${NODE_ID}/ \\ \n && cp -r ${BACKUP_DIR}/snapshots ${DATA_DIR}/${NODE_ID}/ \\ \n && chown -R influxdb:influxdb ${DATA_DIR}/${NODE_ID} \\ \n && systemctl start influxdb3"}]}},computed:{configBase(){return{title:"Influx DB",name:"influx",driver:this.driver,server:"srv-influx",format:"tar",token:"your_token",storages:["sftp","local"],remove_dump:!0}}},mounted(){this.yamlConfig=[{title:"Default",value:{databases:{influx_db:{...this.configBase}}}},{title:"archive",value:{databases:{influx_db:{...this.configBase,archive:!0}}}},{title:"docker",value:{databases:{influx_db:{...this.configBase,docker:{enabled:!0,command:"docker compose --file /var/www/docker-compose.yaml exec -T influxdb"}}}}},{title:"shell",value:{databases:{influx_db:{...this.configBase,shell:{enabled:!0,after:"command runs after create dump",before:"command runs before create dump"}}}}},{title:"encrypt",value:{databases:{influx_db:{...this.configBase,encrypt:{enabled:!0,type:"aes",password:"123456"}}}}},{title:"All",value:{databases:{influx_db:{...this.configBase,archive:!0,docker:{enabled:!0,command:"docker compose --file /var/www/docker-compose.yaml exec -T influxdb"},shell:{enabled:!0,after:"command runs after create dump",before:"command runs before create dump"},encrypt:{enabled:!0,type:"aes",password:"123456"}}}}},{title:"disabled",value:{databases:{influx_db:{...this.configBase,archive:!1,docker:{enabled:!1},shell:{enabled:!1},encrypt:{enabled:!1}}}}}]}},g={class:"pb-5"},D={class:"pb-5"},h={class:"pb-5"},I={class:"pb-5"},q={class:"pb-5"},A={class:"pb-5"};function B($,t,F,R,r,w){const i=v,d=m,f=c,p=u;return _(),b(k,null,[e("div",g,[e("h2",null,n(r.database),1)]),e("div",D,[a(l,{border:"start",variant:"text",density:"compact"},{default:s(()=>[e("p",null,[t[0]||(t[0]=o(" Dumper uses ",-1)),a(i,{items:r.utility},null,8,["items"]),o(" utility to backup "+n(r.database)+" database. ",1)]),t[1]||(t[1]=e("p",null,"The first step is to install the utility to create a database dump for your env.",-1)),t[2]||(t[2]=e("p",null,"The final backup file will always be archived.",-1))]),_:1})]),e("div",h,[a(l,{variant:"text",type:"warning",density:"compact"},{default:s(()=>[...t[3]||(t[3]=[e("p",null," If you are using docker, you must have a backup path similar to the path to the server.",-1)])]),_:1})]),e("div",I,[t[4]||(t[4]=e("h2",null,"Config keys",-1)),a(i,{items:["driver: "+r.driver]},null,8,["items"]),a(d,{items:r.configKeys},null,8,["items"])]),e("div",q,[a(f,{configObject:r.yamlConfig},null,8,["configObject"])]),e("div",A,[a(p,{items:r.restoreDatabase},null,8,["items"])])],64)}const V=y(x,[["render",B]]);export{V as default};

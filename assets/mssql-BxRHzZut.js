import{_ as l}from"./RestoreDatabase-DsAlgOWn.js";import{_ as c}from"./YamlViewer-CBFwknr4.js";import{_ as p}from"./List-D4B3pgq0.js";import{_ as m}from"./Chip-CDMNjWCC.js";import{_ as f,c as b,a as t,t as o,b as a,w as y,F as v,o as k,d as i}from"./index-Bd5gkM0H.js";import{V as _}from"./VAlert-Cjy1JjhA.js";import"./VSlideGroup-Bi6C3yRJ.js";const h={components:{RestoreDatabase:l},data(){return{driver:"mssql",database:"Microsoft SQL",utility:["sqlcmd"],snackbar:!1,configKeys:[{key:"title",value:"Human-readable database name",type:"string",required:!1,info:{text:"",link:""}},{key:"name",value:"Database name (by default, the key name)",type:"string",required:!0,info:{text:"",link:""}},{key:"user",value:"Database username",type:"string",required:!0,info:{text:"",link:""}},{key:"password",value:"Database user's password",type:"string",required:!0,info:{text:"",link:""}},{key:"server",value:"The link to the server from the servers section list",type:"string",required:!0,info:{text:"",link:""}},{key:"port",value:"Database connection port",type:"integer",required:!0,info:{text:"",link:""}},{key:"driver",value:"Driver database",type:"string",required:!0,info:{text:"",link:""}},{key:"format",value:"Database dump format",type:"string",required:!0,info:{text:'Format list: "bac", "bacpac"',link:""}},{key:"archive",value:"Archiving a backup file",type:"boolean",required:!1,info:{text:"",link:""}},{key:"remove_dump",value:"Remove dump file after created (default true)",type:"boolean",required:!1,info:{text:"",link:""}},{key:"storages",value:"Storage list when the dump need to upload",type:"array",required:!0,info:{text:"(Not required if storage set up in global setting)",link:""}},{key:"encrypt",value:"Encrypt database",type:"object",required:!1,info:{text:"",link:"#/crypt/database"}},{key:"shell",value:"Run shell scrypt",type:"object",required:!1,info:{text:"",link:"#/shell"}},{key:"docker",value:"Create dump in docker",type:"object",required:!1,info:{text:"",link:"#/docker"}},{key:"options",value:"Additional options for the database",type:"object",required:!1,info:{text:"",link:""},sub:[{key:"ssl",value:"SSL",type:"bool",required:!1},{key:"source",value:"Full path to dump util",type:"string",required:!1}]},{key:"dir_remote",value:"Dir remote for dumps",type:"string",required:!1,info:{text:'default value from global settings (if the default value is not set, then "./" is used.)',link:""}}],yamlConfig:[],restoreDatabase:[{title:"Use this command to restore database if you use one.bacpac:",value:'$ sqlpackage /Action:Import /SourceFile:"one.bacpac" /TargetServerName:"localhost" /TargetDatabaseName:"MyDatabase" /TargetUser:sa'},{title:"If you have one.bak file:",value:`$ sqlcmd -S localhost -U sa -C -Q "
RESTORE DATABASE MyDB
FROM DISK = '/dump/myDB.bak'
WITH MOVE 'MyDB' TO '/var/opt/mssql/data/MyDB.mdf',
     MOVE 'MyDB_log' TO '/var/opt/mssql/data/MyDB_log.ldf',
     REPLACE
"`}]}},computed:{configBase(){return{title:"My DB Microsoft SQL",name:"mydb",user:"sa",password:"myPassword1",port:5432,driver:this.driver,server:"srv-mssql",format:"bacpac",storages:["sftp","ftp"],remove_dump:!0}}},mounted(){this.yamlConfig=[{title:"Default",value:{databases:{mssql_db:{...this.configBase}}}},{title:"With archive",value:{databases:{mssql_db:{...this.configBase,archive:!0}}}},{title:"With docker",value:{databases:{mssql_db:{...this.configBase,docker:{enabled:!0,command:"docker compose --file /var/www/docker-compose.yaml exec -T postgres"}}}}},{title:"With shell",value:{databases:{mssql_db:{...this.configBase,shell:{enabled:!0,after:'echo "run script before create dump',before:'echo "run script after create dump'}}}}},{title:"With encrypt",value:{databases:{mssql_db:{...this.configBase,encrypt:{enabled:!0,type:"aes",password:"123456"}}}}},{title:"With All",value:{databases:{mssql_db:{...this.configBase,archive:!0,docker:{enabled:!0,command:"docker compose --file /var/www/docker-compose.yaml exec -T mssql"},shell:{enabled:!0,after:'echo "run script before create dump',before:'echo "run script after create dump'},encrypt:{enabled:!0,type:"aes",password:"123456"}}}}},{title:"With disabled",value:{databases:{mssql_db:{...this.configBase,archive:!1,docker:{enabled:!1},shell:{enabled:!1},encrypt:{enabled:!1}}}}}]}},g={class:"pb-5"},q={class:"pb-5"},D={class:"pb-5"},x={class:"pb-5"},B={class:"pb-5"};function w(M,s,S,T,e,A){const r=m,n=p,u=c,d=l;return k(),b(v,null,[t("div",g,[t("h2",null,o(e.database),1)]),t("div",q,[a(_,{border:"start",variant:"text",density:"compact"},{default:y(()=>[s[0]||(s[0]=i(" Dumper uses ",-1)),a(r,{items:e.utility},null,8,["items"]),i(" utility to backup "+o(e.database)+" database ",1)]),_:1})]),t("div",D,[s[1]||(s[1]=t("h2",null,"Config keys",-1)),a(r,{items:["driver: "+e.driver]},null,8,["items"]),a(n,{items:e.configKeys},null,8,["items"])]),t("div",x,[a(u,{configObject:e.yamlConfig},null,8,["configObject"])]),t("div",B,[a(d,{items:e.restoreDatabase},null,8,["items"])])],64)}const F=f(h,[["render",w]]);export{F as default};
